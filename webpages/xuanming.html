<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ éšæœºç‚¹åå™¨ Â· TXTå¤–éƒ¨å¯¼å…¥</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            background: linear-gradient(145deg, #f0f4fa 0%, #d9e2ef 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .card {
            max-width: 700px;
            width: 100%;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 40px;
            box-shadow: 0 20px 40px rgba(0, 20, 40, 0.25), 0 8px 16px rgba(0, 0, 0, 0.1);
            padding: 35px 30px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e2b3c;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            letter-spacing: -0.5px;
        }

        h1 span {
            background: #2d4059;
            color: #fbd46d;
            font-size: 1.2rem;
            padding: 0 18px;
            border-radius: 60px;
            line-height: 2.2;
            font-weight: 500;
        }

        .sub {
            color: #3a4e6b;
            margin-bottom: 30px;
            font-size: 1.1rem;
            border-left: 5px solid #fbd46d;
            padding-left: 18px;
            background: rgba(251, 212, 109, 0.15);
            border-radius: 0 20px 20px 0;
        }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            background: white;
            border-radius: 28px;
            padding: 18px 24px;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.03), 0 8px 14px rgba(45, 64, 89, 0.1);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 15px;
            margin-bottom: 28px;
            border: 2px dashed #b3c7e5;
            transition: border 0.2s;
        }
        .upload-area:hover {
            border-color: #fbd46d;
        }

        .file-label {
            background: #2d4059;
            color: white;
            padding: 12px 28px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            box-shadow: 0 8px 12px rgba(0,0,0,0.1);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            border: none;
        }
        .file-label:hover {
            background: #1f2e42;
            transform: scale(1.02);
        }
        .file-label:active {
            transform: scale(0.98);
        }
        .file-label i {
            font-size: 1.3rem;
        }

        #file-info {
            flex: 1;
            font-size: 0.95rem;
            color: #1e2b3c;
            background: #eef3fc;
            padding: 10px 20px;
            border-radius: 40px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 500;
            border: 1px solid #cbd6e6;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .stat-item {
            background: white;
            border-radius: 30px;
            padding: 16px 28px;
            flex: 1 1 auto;
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.04);
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid #eef2f7;
        }
        .stat-icon {
            font-size: 2rem;
            background: #f0f5fd;
            width: 60px;
            height: 60px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .stat-content h3 {
            font-size: 1.8rem;
            font-weight: 800;
            color: #1e2b3c;
            line-height: 1.2;
        }
        .stat-content p {
            color: #5f6f84;
            font-weight: 500;
            font-size: 1rem;
        }

        /* åå•é¢„è§ˆ (ç®€æ´) */
        .preview-box {
            background: #f8fafd;
            border-radius: 24px;
            padding: 18px 20px;
            margin-bottom: 30px;
            border: 1px solid #d9e2ef;
            max-height: 180px;
            overflow-y: auto;
            font-size: 0.95rem;
            color: #2b3f59;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.02);
        }
        .preview-box p {
            display: inline-block;
            background: white;
            padding: 6px 16px;
            border-radius: 40px;
            margin: 5px 8px 5px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            border: 1px solid #e2eaf3;
        }
        .preview-placeholder {
            color: #8b9bb5;
            font-style: italic;
            text-align: center;
            padding: 15px;
        }

        /* ç‚¹åä¸»åŒºåŸŸ */
        .call-area {
            background: linear-gradient(120deg, #ffffff, #f5faff);
            border-radius: 60px;
            padding: 30px 25px;
            margin: 30px 0 25px;
            box-shadow: 0 12px 22px rgba(0, 20, 40, 0.15);
            border: 1px solid white;
        }
        .current-label {
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #4b6589;
            font-weight: 600;
        }
        .current-name {
            font-size: 4rem;
            font-weight: 800;
            color: #1e2b3c;
            line-height: 1.2;
            margin: 5px 0 10px;
            word-break: break-word;
            min-height: 6rem;
            background: rgba(251, 212, 109, 0.2);
            border-radius: 50px;
            padding: 15px 30px;
            text-align: center;
            border: 2px solid #fbd46d;
        }
        .call-btn {
            background: #fbd46d;
            border: none;
            color: #1e2b3c;
            font-size: 2rem;
            font-weight: 700;
            padding: 18px 30px;
            border-radius: 80px;
            width: 100%;
            cursor: pointer;
            transition: 0.15s;
            box-shadow: 0 16px 24px -8px rgba(251, 212, 109, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            border: 2px solid #ffe28c;
        }
        .call-btn:hover {
            background: #ffde8a;
            transform: scale(1.02);
            box-shadow: 0 20px 28px -6px #fbd46d;
        }
        .call-btn:active {
            transform: scale(0.98);
            background: #e5be5c;
        }
        .call-btn:disabled {
            opacity: 0.5;
            pointer-events: none;
            background: #c0cbd9;
            box-shadow: none;
            border-color: #a5b3c9;
        }

        /* å†å²è®°å½• */
        .history-title {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 12px;
        }
        .history-title h2 {
            font-size: 1.5rem;
            color: #1e2b3c;
            font-weight: 600;
        }
        .clear-btn {
            background: none;
            border: 1px solid #b3c7e5;
            padding: 6px 20px;
            border-radius: 40px;
            font-size: 0.9rem;
            color: #4b6589;
            cursor: pointer;
            transition: 0.1s;
        }
        .clear-btn:hover {
            background: #eef3fc;
            border-color: #8ba0c0;
        }
        .history-list {
            background: #f8fafd;
            border-radius: 30px;
            padding: 20px;
            min-height: 70px;
            max-height: 140px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            border: 1px solid #d9e2ef;
        }
        .history-item {
            background: white;
            border-radius: 40px;
            padding: 8px 22px;
            font-weight: 600;
            color: #1e2b3c;
            box-shadow: 0 2px 6px rgba(0,0,0,0.03);
            border: 1px solid #cfddee;
            font-size: 1.1rem;
        }

        .history-empty {
            color: #8b9bb5;
            width: 100%;
            text-align: center;
            font-style: italic;
        }

        /* éšè—åŸå§‹input */
        #file-input {
            display: none;
        }

        footer {
            margin-top: 25px;
            font-size: 0.9rem;
            color: #6a7f9c;
            text-align: center;
            border-top: 1px dashed #c9d6e8;
            padding-top: 20px;
        }
    </style>
</head>
<body>
<div class="card">
    <h1>
        ğŸ“‹ éšæœºç‚¹åå™¨
        <span>TXT</span>
    </h1>
    <div class="sub">å¤–éƒ¨å¯¼å…¥ Â· æ ¼å¼ â€œ1.å¼ ä¸‰ä¸°â€ è‡ªåŠ¨è§£æ</div>

    <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
    <div class="upload-area">
        <label for="file-input" class="file-label">
            ğŸ“‚ é€‰æ‹©TXTæ–‡ä»¶
        </label>
        <input type="file" id="file-input" accept=".txt, text/plain">
        <div id="file-info">æœªé€‰æ‹©æ–‡ä»¶</div>
    </div>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="stats">
        <div class="stat-item">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-content">
                <h3 id="total-count">0</h3>
                <p>åå•æ€»æ•°</p>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">ğŸ²</div>
            <div class="stat-content">
                <h3 id="called-count">0</h3>
                <p>å·²ç‚¹æ¬¡æ•°</p>
            </div>
        </div>
    </div>

    <!-- åå•é¢„è§ˆ (åªæ˜¾ç¤ºå‰å‡ ä¸ªï¼Œä»¥å…å¤ªé•¿) -->
    <div class="preview-box" id="preview-container">
        <div class="preview-placeholder">â« ä¸Šä¼ TXTæ–‡ä»¶åé¢„è§ˆåå•</div>
    </div>

    <!-- ç‚¹åæ ¸å¿ƒåŒº -->
    <div class="call-area">
        <div class="current-label">æœ¬æ¬¡æŠ½ä¸­ç‚¹å</div>
        <div class="current-name" id="current-name-display">â€”â€”</div>
        <button class="call-btn" id="call-btn" disabled>
            <span>ğŸ²</span> éšæœºç‚¹å <span>ğŸ²</span>
        </button>
    </div>

    <!-- å†å²è®°å½• -->
    <div class="history-title">
        <h2>ğŸ“œ å†å²è®°å½•</h2>
        <button class="clear-btn" id="clear-history" title="æ¸…ç©ºå†å²">æ¸…ç©º</button>
    </div>
    <div class="history-list" id="history-list">
        <div class="history-empty">æš‚æ— ç‚¹åè®°å½•</div>
    </div>

    <footer>
        TXTæ ¼å¼è¦æ±‚ï¼šæ¯è¡Œä¸€æ¡ï¼Œå¯åŒ…å«ç¼–å·å¦‚ â€œ1.å¼ ä¸‰ä¸°â€ æˆ– â€œ2. æå››â€ ï¼Œç¨‹åºè‡ªåŠ¨æå–å§“åã€‚<br>
        ç©ºè¡Œè‡ªåŠ¨å¿½ç•¥ã€‚
    </footer>
</div>

<script>
    (function() {
        // DOM å…ƒç´ 
        const fileInput = document.getElementById('file-input');
        const fileInfo = document.getElementById('file-info');
        const totalSpan = document.getElementById('total-count');
        const calledSpan = document.getElementById('called-count');
        const previewDiv = document.getElementById('preview-container');
        const currentNameDisplay = document.getElementById('current-name-display');
        const callBtn = document.getElementById('call-btn');
        const historyListDiv = document.getElementById('history-list');
        const clearHistoryBtn = document.getElementById('clear-history');

        // æ•°æ®å­˜å‚¨
        let nameList = [];                // çº¯å§“åæ•°ç»„
        let callHistory = [];             // å·²ç‚¹å§“åï¼ˆæŒ‰é¡ºåºï¼‰
        let currentName = 'â€”â€”';

        // æ›´æ–°UIï¼šæ€»äººæ•°ã€é¢„è§ˆã€ç‚¹åæŒ‰é’®çŠ¶æ€
        function refreshUI() {
            // æ€»äººæ•°
            totalSpan.textContent = nameList.length;

            // å·²ç‚¹æ¬¡æ•°
            calledSpan.textContent = callHistory.length;

            // é¢„è§ˆåŒºåŸŸï¼ˆæœ€å¤šæ˜¾ç¤º12ä¸ªï¼Œé¿å…å¤ªé•¿ï¼‰
            previewDiv.innerHTML = '';
            if (nameList.length === 0) {
                previewDiv.innerHTML = '<div class="preview-placeholder">ğŸ“­ åå•ä¸ºç©ºï¼Œè¯·ä¸Šä¼ TXTæ–‡ä»¶</div>';
            } else {
                const showItems = nameList.slice(0, 20); // æ˜¾ç¤ºå‰20ä¸ª
                showItems.forEach((name, idx) => {
                    const tag = document.createElement('p');
                    tag.textContent = name;
                    previewDiv.appendChild(tag);
                });
                if (nameList.length > 20) {
                    const more = document.createElement('p');
                    more.textContent = `... ç­‰${nameList.length}äºº`;
                    more.style.background = '#e9f0f9';
                    previewDiv.appendChild(more);
                }
            }

            // ç‚¹åæŒ‰é’®æ˜¯å¦å¯ç”¨
            callBtn.disabled = (nameList.length === 0);
        }

        // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
        function refreshHistory() {
            historyListDiv.innerHTML = '';
            if (callHistory.length === 0) {
                historyListDiv.innerHTML = '<div class="history-empty">æš‚æ— ç‚¹åè®°å½•</div>';
                return;
            }
            // æ˜¾ç¤ºæœ€è¿‘çš„15æ¡ï¼ˆå€’åºï¼Œæœ€æ–°çš„åœ¨å‰ï¼‰
            const recent = [...callHistory].reverse().slice(0, 15);
            recent.forEach(name => {
                const item = document.createElement('span');
                item.className = 'history-item';
                item.textContent = name;
                historyListDiv.appendChild(item);
            });
            if (callHistory.length > 15) {
                const more = document.createElement('span');
                more.className = 'history-item';
                more.textContent = `...ç­‰${callHistory.length}æ¬¡`;
                historyListDiv.appendChild(more);
            }
        }

        // æ¸…ç©ºå†å²
        clearHistoryBtn.addEventListener('click', () => {
            callHistory = [];
            refreshHistory();
            refreshUI();  // æ›´æ–°â€œå·²ç‚¹æ¬¡æ•°â€
        });

        // è§£æTXTæ–‡æœ¬ï¼Œæå–å§“å
        function parseTXT(text) {
            const lines = text.split(/\r?\n/);
            const names = [];

            for (let line of lines) {
                line = line.trim();
                if (line === '') continue;  // å¿½ç•¥ç©ºè¡Œ

                // å°è¯•åŒ¹é… "1.å¼ ä¸‰ä¸°" æˆ– "2. æå››" æˆ– "10ã€ç‹äº”" ç­‰å¤šç§é£æ ¼
                // è§„åˆ™ï¼šè¡Œé¦–å¯èƒ½å«æ•°å­— + å¯é€‰åˆ†éš”ç¬¦(. ã€) + å¯é€‰ç©ºæ ¼ï¼Œç„¶åæ•è·å‰©ä¸‹çš„éƒ¨åˆ†
                const match = line.match(/^\s*\d+[\.ï¼ã€\s]\s*(.+)$/);
                if (match) {
                    // æå–å§“åå¹¶å»é™¤é¦–å°¾ç©ºæ ¼
                    let name = match[1].trim();
                    if (name) {
                        names.push(name);
                    } else {
                        // å¦‚æœç‚¹åé¢æ²¡æœ‰å†…å®¹ï¼Œå°±æŠŠæ•´è¡Œå½“å§“åï¼ˆä½†å»é™¤ç¼–å·éƒ¨åˆ†ä¸æˆåŠŸï¼Œç”¨åŸè¡Œï¼‰
                        names.push(line.replace(/^\s*\d+[\.ï¼ã€\s]\s*/, '').trim() || line);
                    }
                } else {
                    // ä¸ç¬¦åˆç¼–å·æ¨¡å¼ï¼Œä½†éç©ºè¡Œï¼Œå°±ç›´æ¥ä½œä¸ºå§“åï¼ˆå…è®¸è‡ªå®šä¹‰ï¼‰
                    names.push(line);
                }
            }
            return names;
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) {
                fileInfo.textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
                nameList = [];
                refreshUI();
                return;
            }

            fileInfo.textContent = `ğŸ“„ ${file.name}`;

            const reader = new FileReader();
            reader.onload = function(ev) {
                const content = ev.target.result;
                const parsed = parseTXT(content);
                nameList = parsed;
                // é‡ç½®å†å²ï¼ˆæ¯æ¬¡å¯¼å…¥æ–°åå•ï¼Œå†å²æ¸…ç©ºæ¯”è¾ƒåˆç†ï¼‰
                callHistory = [];
                currentNameDisplay.textContent = 'â€”â€”';
                refreshUI();
                refreshHistory();
            };
            reader.onerror = function() {
                alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
                nameList = [];
                refreshUI();
            };
            reader.readAsText(file, 'UTF-8');
        });

        // éšæœºç‚¹å
        callBtn.addEventListener('click', function() {
            if (nameList.length === 0) {
                alert('è¯·å…ˆå¯¼å…¥åå•');
                return;
            }

            // éšæœºæŠ½å–ä¸€ä¸ªå§“å
            const randomIndex = Math.floor(Math.random() * nameList.length);
            const chosen = nameList[randomIndex];

            // æ›´æ–°å½“å‰æ˜¾ç¤º
            currentName = chosen;
            currentNameDisplay.textContent = chosen;

            // è®°å½•åˆ°å†å²
            callHistory.push(chosen);
            if (callHistory.length > 50) {  // æœ€å¤šä¿ç•™50æ¡ï¼Œé˜²æ­¢æº¢å‡º
                callHistory.shift();
            }

            // æ›´æ–°ç•Œé¢
            refreshHistory();
            refreshUI(); // æ›´æ–°å·²ç‚¹æ¬¡æ•°
        });

        // åˆå§‹åŒ–UI
        refreshUI();
        refreshHistory();

        // é™„åŠ ï¼šç‚¹å‡»file labelåï¼Œå¦‚æœå†æ¬¡é€‰æ‹©ç›¸åŒæ–‡ä»¶ä¸è§¦å‘changeï¼Ÿå·²ç»èƒ½è§¦å‘
        // æä¾›ä¸€ä¸ªå°æç¤ºï¼šå…è®¸æ‹–æ‹½ï¼Ÿä½†åŸºç¡€åŠŸèƒ½å·²æ»¡è¶³

        // å¯é€‰ï¼šæ·»åŠ ä¸€ä¸ªç¤ºä¾‹æ–‡ä»¶æµ‹è¯•æŒ‰é’®ï¼ˆç”¨æˆ·å¯è‡ªè¡Œåˆ›å»ºTXTï¼‰
        // ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼ŒåŠ ä¸€ä¸ªéšè—çš„ç¤ºä¾‹æ•°æ®ç”Ÿæˆå™¨ï¼ˆä¸è‡ªåŠ¨å¡«å……ï¼Œå°Šé‡å¤–éƒ¨å¯¼å…¥ï¼‰
        // ä½†ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œå¯æ·»åŠ ä¸€ä¸ªâ€œè¯•ç”¨ç¤ºä¾‹â€æŒ‰é’®ç”Ÿæˆå†…ç½®å‡æ•°æ®ï¼Œä½†é¢˜ç›®å¼ºè°ƒå¤–éƒ¨å¯¼å…¥ï¼Œæ•…ä¸å¼•å…¥ï¼Œä¿ç•™çº¯ç²¹æ€§ã€‚
    })();
</script>
</body>
</html>